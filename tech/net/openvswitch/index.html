<!DOCTYPE html>
<html lang="zh-CN">
  <head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="OpenVSwitch" />
    <title>OpenVSwitch | Cold World</title>
    <link rel="stylesheet" href="/css/style.css" /> 
    <link rel="stylesheet" href="/css/fonts.css" /> 
    <link rel="stylesheet" href="/css/syntax.css" />
    <link rel="stylesheet" href="/css/code.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
</head>

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
</noscript>
  </head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="OpenVSwitch" />
    <title>OpenVSwitch | Cold World</title>
    <link rel="stylesheet" href="/css/style.css" /> 
    <link rel="stylesheet" href="/css/fonts.css" /> 
    <link rel="stylesheet" href="/css/syntax.css" />
    <link rel="stylesheet" href="/css/code.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
</head>

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
</noscript><body><div class="header">
  <nav class="nav">
    <div class="logo">
      <a href="http://www.coldcoding.top" accesskey="h" title="Cold World">
        <img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/20240219225844.jpg" alt="logo" aria-label="logo">
        Cold World
      </a>
    </div>
    <nav class="menuPc">
      <ul class="menu wide">
        <a class="menu-item"
                href="/tech/" > Tech 
            </a><a class="menu-item"
                href="/life/" > Life 
            </a>
            <div class="dropdown pc">
                <a href="javascript:void(0);" 
                    class="menu-item menu-more dropbtn" title="" > Archive 
                </a>
                <div class="menu-more-content dropdown-content"><a href="/categories/" title="" > Categories 
                    </a><a href="/tags/" title="" > Tags 
                    </a></div>
            </div>
          <a class="menu-item"
                href="/weekly/" > Weekly 
            </a><a class="menu-item"
                href="/about/" > About 
            </a><a class="menu-item"
                href="/index.xml" > RSS 
            </a></ul>
    </nav>
    <a id="search-btn" href="javascript:void(0);">
      <span class="relative block icon">
        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
      </span>
    </a>
    <div id="fastSearch">
      <input id="searchInput" tabindex="0">
      <ul id="searchResults"></ul>
    </div>
    <div class="menuMobile">
      <button id="menu-button" onclick="toggleMenu()">
        <span class="relative block icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"></path></svg>
        </span>
      </button>
      <div class="menu-overlay" id="menuOverlay">
        <ul class="menu-items" id="menuItems">
          <li>
            <button onclick="closeMenu()">
              <span class="relative block icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path></svg>
              </span>
            </button>
          </li><li>
              <a class="menu-item"
                href="/tech/" > Tech 
            </a>
            </li><li>
              <a class="menu-item"
                href="/life/" > Life 
            </a>
            </li>
            <li>
              <div class="dropdown mobile">
                <a href="javascript:void(0);" class="menu-item menu-more dropbtn" title="" > Archive 
                </a>
                <div class="menu-more-content dropdown-content"><a href="/categories/" title="" > Categories </a><a href="/tags/" title="" > Tags </a></div>
              </div>
            </li>
          <li>
              <a class="menu-item"
                href="/weekly/" > Weekly 
            </a>
            </li><li>
              <a class="menu-item"
                href="/about/" > About 
            </a>
            </li><li>
              <a class="menu-item"
                href="/index.xml" > RSS 
            </a>
            </li></ul>
      </div>
    </div>
  </nav>
</div>

<script>
  let documentTop = 0; 
  const body = document.body;

  function toggleMenu() {
    var menuOverlay = document.getElementById("menuOverlay");
    menuOverlay.classList.toggle("show");
    if (menuOverlay.classList.contains("show")) {
      
      var menuButton = document.getElementById("menu-button");
      menuButton.style.display = "none";
      
      documentTop = document.scrollingElement.scrollTop;
      body.style.position = "fixed"
      body.style.top = -documentTop + "px";
    }
  }

  document.addEventListener("click", function(event) {
    if (menuOverlay.classList.contains("show")) {
      console.log(event.target)
      if (event.target.classList.contains("show")) {
        closeMenu(); 
      }
    }
  });
  
  function closeMenu() {
    var menuOverlay = document.getElementById("menuOverlay");
    menuOverlay.classList.remove("show");
    var menuButton = document.getElementById("menu-button");
    menuButton.style.display = "inline-block";
    
    body.style.position = "static";
    body.style.top = "auto";
    document.scrollingElement.scrollTop = documentTop;
  }
</script>

<script src="/js/fuse.min.js"></script>
<script src="/js/fastsearch.js"></script><div class="main page">
<article class="post-single">
  <div id="single-content">
    <header class="post-header">
      <div class="breadcrumbs"><div  class="breadcrumb">
    
    


    <a href="http://coldcoding.top/">ğŸ  Home</a>&nbsp;Â»&nbsp;<a href="http://coldcoding.top/tech/">ğŸ“‘Tech</a>&nbsp;Â»&nbsp;<a href="http://coldcoding.top/tech/net/">ğŸ•¸ï¸Net</a></div></div>
      <h1 class="post-title">OpenVSwitch</h1>
      <div class="post-meta"><span class="parent-post-meta">
    <span id="post_meta_style_initpost" class="post_meta_style">Published at:</span>2023/07/17&nbsp;&nbsp;&nbsp;
    
    <span id="post_meta_style_pagepv" class="post_meta_style">PagePV:</span><span id="twikoo_visitors">0</span>&nbsp;&nbsp;&nbsp;
    
    
</span></div>
    </header>
      

<aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details >
            <summary accesskey="c" title="(Alt + C)">
                
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#ovs-%e7%bd%91%e7%bb%9c%e6%9e%b6%e6%9e%84" aria-label="OVS ç½‘ç»œæ¶æ„">OVS ç½‘ç»œæ¶æ„</a><ul>
                            
                    <li>
                        <a href="#ovs-%e5%86%85%e9%83%a8%e7%bb%93%e6%9e%84" aria-label="OVS å†…éƒ¨ç»“æ„">OVS å†…éƒ¨ç»“æ„</a></li>
                    <li>
                        <a href="#%e6%95%b0%e6%8d%ae%e6%b5%81%e5%90%91" aria-label="æ•°æ®æµå‘">æ•°æ®æµå‘</a></li>
                    <li>
                        <a href="#%e8%a1%a5%e5%85%85%e7%bd%91%e7%bb%9c%e6%a6%82%e5%bf%b5" aria-label="è¡¥å……ç½‘ç»œæ¦‚å¿µ">è¡¥å……ç½‘ç»œæ¦‚å¿µ</a></li></ul>
                    </li>
                    <li>
                        <a href="#vlog" aria-label="VLOG">VLOG</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
    <div class="post-content"><h3 id="ovs-ç½‘ç»œæ¶æ„">OVS ç½‘ç»œæ¶æ„</h3>
<p>Open vswitch æ˜¯ä¸€ä¸ªå¼€æ”¾çš„è™šæ‹Ÿäº¤æ¢æœºï¼Œæ”¯æŒ openflow åè®®ï¼Œè¢«è¿œç«¯çš„æ§åˆ¶å™¨é€šè¿‡ openflow åè®®ç»Ÿä¸€ç®¡ç†ï¼Œä»è€Œå®ç°å¯¹æ¥å…¥çš„è™šæ‹Ÿæœºæˆ–è®¾å¤‡è¿›è¡Œç»„ç½‘å’Œäº’é€šï¼Œä¸»è¦ä½œç”¨å°±æ˜¯:</p>
<ol>
<li>ä¼ é€’è™šæ‹Ÿæœºä¹‹é—´çš„æµé‡</li>
<li>å®ç°è™šæ‹Ÿæœºå’Œå¤–ç•Œç½‘ç»œä¹‹é—´çš„é€šä¿¡</li>
</ol>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907141824441.png" alt="æ•´ä½“ç»„ç½‘ç»“æ„"></p>
<h4 id="ovs-å†…éƒ¨ç»“æ„">OVS å†…éƒ¨ç»“æ„</h4>
<img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/OVSç½‘ç»œæ¶æ„2.png" alt="OVSç½‘ç»œæ¶æ„2" style="zoom:67%;" />
<p>OVS æœ‰ä¸‰ä¸ªæ ¸å¿ƒçš„éƒ¨åˆ†:</p>
<ol>
<li>ovs-vswitchd: å®ç° OVS å®ˆæŠ¤è¿›ç¨‹ daemonï¼ŒOVS çš„æ ¸å¿ƒéƒ¨ä»¶ï¼Œå®ç°äº¤æ¢åŠŸèƒ½ï¼Œå’Œ Linux å†…æ ¸å…¼å®¹æ¨¡å—ä¸€èµ·ï¼Œå®ç°åŸºäºæµçš„äº¤æ¢ï¼ˆflow-based switchingï¼‰ã€‚å®ƒå’Œä¸Šå±‚ controller é€šä¿¡éµä» OPENFLOW åè®®ï¼Œå®ƒä¸ ovsdb-server é€šä¿¡ä½¿ç”¨ OVSDB åè®®ï¼Œå®ƒå’Œå†…æ ¸æ¨¡å—é€šè¿‡ netlink é€šä¿¡ï¼Œå®ƒæ”¯æŒå¤šä¸ªç‹¬ç«‹çš„ datapathï¼ˆç½‘æ¡¥ï¼‰ï¼Œå®ƒé€šè¿‡æ›´æ”¹ flow table å®ç°äº†ç»‘å®šå’Œ VLAN ç­‰åŠŸèƒ½ã€‚</li>
<li>ovsdb-server: è½»é‡çº§çš„æ•°æ®åº“æœåŠ¡ï¼Œä¸»è¦ä¿å­˜äº†æ•´ä¸ª OVS çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ portã€äº¤æ¢å†…å®¹ã€VLAN ç­‰ã€‚ovs-vswitchd ä¼šæ ¹æ®æ•°æ®åº“ä¸­çš„é…ç½®ä¿¡æ¯å·¥ä½œã€‚å®ƒäº manager å’Œ ovs-vswitchd äº¤æ¢ä¿¡æ¯ä½¿ç”¨äº† OVSDB(JSON-RPC) çš„æ–¹å¼ã€‚</li>
<li>ovs kernal module(datapath + flowtable): å†…æ ¸æ¨¡å—ï¼Œè´Ÿè´£æ‰§è¡Œæ•°æ®å¤„ç†ï¼ŒæŠŠä»æ¥æ”¶ç«¯å£æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨æµè¡¨ä¸­è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…åˆ°çš„åŠ¨ä½œã€‚å¤„ç†åŒ…äº¤æ¢å’Œéš§é“ï¼Œç¼“å­˜ flowï¼Œå¦‚æœåœ¨å†…æ ¸çš„ç¼“å­˜ä¸­æ‰¾åˆ°è½¬å‘è§„åˆ™åˆ™è½¬å‘ï¼Œå¦åˆ™å‘å‘ç”¨æˆ·ç©ºé—´å»å¤„ç†ã€‚ä¸€ä¸ª datapath å¯ä»¥å¯¹åº”å¤šä¸ª vportï¼Œä¸€ä¸ª vport ç±»ä¼¼ç‰©ç†äº¤æ¢æœºçš„ç«¯å£æ¦‚å¿µã€‚æ¯ä¸€ä¸ª ovs ç½‘æ¡¥ï¼ˆäº¤æ¢æœºï¼‰éƒ½æœ‰ä¸€ä¸ªå†…æ ¸ç©ºé—´çš„ datapath ä¸ä¹‹ç›¸å¯¹åº”ï¼Œå¯ä»¥è¯´è¿™ä¸ª datapath å°±æ˜¯ ovs ç½‘æ¡¥ï¼ˆäº¤æ¢æœºï¼‰çš„å®ä½“ï¼Œæ•°æ®æµéƒ½æ˜¯å—å®ƒæ§åˆ¶ï¼Œè€Œå®ƒæ˜¯æ ¹æ® flow table ã€‚æ¯ä¸€ä¸ª datapth åœ¨å†…æ ¸ä¸­éƒ½å…³è”ä¸€ä¸ª flow tableï¼Œä¸€ä¸ª flow table åŒ…å«å¤šä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®åŒ…æ‹¬ä¸¤ä¸ªå†…å®¹ï¼šä¸€ä¸ª match/key å’Œä¸€ä¸ª actionã€‚</li>
</ol>
<p>ä¸ºäº†æ–¹ä¾¿é…ç½®å’Œç®¡ç†ï¼Œæ‰€ä»¥æœ‰äº†ä¸‹é¢çš„å·¥å…·:</p>
<ul>
<li>ovs-dpctl: ç”¨æ¥é…ç½®äº¤æ¢æœºå†…æ ¸æ¨¡å—ï¼Œå¯ä»¥æ§åˆ¶è½¬å‘è§„åˆ™ã€‚</li>
<li>ovs-vsctl: ç”¨æ¥æŸ¥è¯¢æˆ–æ›´æ–° ovs-vswitchd çš„é…ç½®ä¿¡æ¯ï¼Œæ“ä½œå¯¹è±¡æ˜¯ ovsdb-server ï¼ŒæŸ¥è¯¢å’Œæ›´æ–° ovsdb-server ä¸­çš„æ•°æ®åº“ã€‚æ›´æ–°æ•°æ®åº“çš„æ—¶å€™ï¼Œå‘½ä»¤ä¼šç­‰å¾…é…ç½®åœ¨ ovs-vswitchd ç”Ÿæ•ˆåæ‰è¿”å›ã€‚</li>
<li>ovs-appctl: ä¸»è¦æ˜¯å‘ OVS å®ˆæŠ¤è¿›ç¨‹å‘é€å‘½ä»¤çš„ï¼Œä¸€èˆ¬ç”¨ä¸ä¸Šã€‚ovs-appctl ofproto/trace å¯ä»¥ç”¨æ¥ç”Ÿæˆæµ‹è¯•ç”¨çš„æ¨¡æ‹Ÿæ•°æ®åŒ…ï¼Œå¹¶ä¸€æ­¥æ­¥çš„å±•ç¤º OVS å¯¹æ•°æ®åŒ…çš„æµå¤„ç†è¿‡ç¨‹ã€‚</li>
<li>ovsdbmonitor: GUI å·¥å…·æ¥æ˜¾ç¤º ovsdb-server ä¸­æ•°æ®ä¿¡æ¯ã€‚</li>
<li>ovs-controller: ä¸€ä¸ªç®€å•çš„ OpenFlow æ§åˆ¶å™¨ã€‚</li>
<li>ovs-ofctl: ç”¨æ¥æŸ¥è¯¢å’Œæ§åˆ¶ OVS ä½œä¸º OpenFlow äº¤æ¢æœºå·¥ä½œæ—¶å€™çš„æµè¡¨å†…å®¹ã€‚</li>
</ul>
<p>é€šè¿‡æ¶æ„å¯ä»¥çœ‹åˆ°ï¼Œ<strong>ç”¨æˆ·ç©ºé—´</strong>è¿è¡Œäº†ä¸¤ä¸ªè¿›ç¨‹: ovs-vswitchd å’Œ ovsdb-server ã€‚ ç®€å•æ¥è¯´ï¼Œovsdb-server å°† ovs-vswitchd çš„é…ç½®æŒä¹…åŒ–åˆ° db ä¸­ï¼Œä¸€èˆ¬è·¯å¾„æ˜¯åœ¨ /etc/openvswitch/conf.db ä¸­ã€‚ovs-vswitchd æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šå‘ ovsdb-server è¯»å–ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”å¦‚æœæœ‰é…ç½®éœ€è¦æ›´æ–°ä¹Ÿä¼šå°†å…¶åŒæ­¥åˆ° ovsdb-server ä¸­ã€‚ä»–ä»¬ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ Unix åŸŸå¥—æ¥å­—è¿›è¡Œçš„ã€‚<strong>å†…æ ¸ç©ºé—´</strong>ä¸»è¦å°±æ˜¯ datapath å’Œ flow tableã€‚ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„äº¤äº’æ˜¯é€šè¿‡ Netlink åè®®å®ç°çš„ã€‚</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907150437980.png" alt="image-20230907150437980">
æŸ¥çœ‹åŠ è½½åˆ°å†…æ ¸çš„æ¨¡å—</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907151357139.png" alt="image-20230907151357139">
æŸ¥çœ‹è¿›ç¨‹å¯ä»¥çœ‹åˆ°:
<strong>ovs-vswitchd</strong> è¿è¡Œçš„å‘½ä»¤ä¸º <code>ovs-vswitchd unix:/datadisk0/var/run/openvswitch/db.sock</code>ï¼ŒæŒ‡å®šäº†ä¸ <strong>ovsdb-server</strong> é€šä¿¡çš„ Unix åŸŸå¥—æ¥å­—è·¯å¾„ï¼Œç›‘å¬äº†ä¸€ä¸ªæœ¬æœºçš„ db.sock æ–‡ä»¶ã€‚è¿˜æŒ‡å®š VLOG ä¸­çš„ä¸‰ä¸ªåœºåˆçš„æ—¥å¿—çº§åˆ«ä½¿ç”¨ mlockall é€‰é¡¹ï¼Œç”¨äºå°†å†…å­˜é”å®šåœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œä»¥åŠæŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€PID æ–‡ä»¶è·¯å¾„ã€‚
<strong>ovsdb-server</strong> è¿è¡Œçš„å‘½ä»¤ä¸º<code>ovsdb-server /sysdisk0/3rdparty/etc/openvswitch/conf.db</code>ï¼ŒæŒ‡å®šäº†é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå°†é…ç½®ä¿¡æ¯ä¿å­˜åœ¨ conf.db ä¸­ã€‚remote å‚æ•°æŒ‡å®šäº†å’Œæ•°æ®åº“ <strong>ovsdb-server</strong> çš„è¿æ¥æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯ punix: /db.sock è¡¨ç¤ºç›‘å¬çš„ Unix åŸŸå¥—æ¥å­—è·¯å¾„ï¼Œä½¿ç”¨ db.sock è¿›è¡Œè¿›ç¨‹é—´ socket çš„é€šä¿¡ï¼Œæ”¶å‘æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ <strong>ovs-vswitchd</strong> é€šè¿‡è¿™ä¸ª db.sock ä»è¿™ä¸ªè¿›ç¨‹è¯»å–é…ç½®ä¿¡æ¯ã€‚è¿˜ç”¨äº†ä¸€äº›é€‰é¡¹ï¼Œå¦‚æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€PID æ–‡ä»¶è·¯å¾„ã€ä»¥åŠä¸€äº›è¯ä¹¦å’Œå¯†é’¥ç­‰ã€‚</p>
<p><strong>conf.db</strong> æ˜¯ json æ ¼å¼çš„ï¼Œå¯ä»¥ cat å‡ºæ¥ä½¿ç”¨ json å·¥å…·è§£ææˆ–è€…ä½¿ç”¨ ovsdb-client dump å‘½ä»¤å°†æ•°æ®åº“ç»“æ„æ‰“å°å‡ºæ¥ã€‚</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907160656841.png" alt="image-20230907160656841"></p>
<img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/635909-20160907114625238-1863348603.png" alt="æ•°æ®åº“ç»“æ„" style="zoom: 67%;" />
<p>é€šè¿‡ ovs-vsctl åˆ›å»ºçš„æ‰€æœ‰çš„ç½‘æ¡¥ï¼Œç½‘å¡ï¼Œéƒ½ä¿å­˜åœ¨æ•°æ®åº“é‡Œé¢ï¼Œovs-vswitchd ä¼šæ ¹æ®æ•°æ®åº“é‡Œé¢çš„é…ç½®åˆ›å»ºçœŸæ­£çš„ç½‘æ¡¥ï¼Œç½‘å¡ã€‚</p>
<h4 id="æ•°æ®æµå‘">æ•°æ®æµå‘</h4>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907164454232.png" alt="æ•°æ®æµå‘"></p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/ovs-arch.png" alt="ovsåŒ…å¤„ç†æµç¨‹"></p>
<p>ä¸€èˆ¬çš„æ•°æ®åŒ…åœ¨ Linux ç½‘ç»œåè®®ä¸­çš„æµå‘ä¸ºä¸Šå›¾ä¸­çš„è“è‰²ç®­å¤´æµå‘: ç½‘å¡ eth0 æ”¶åˆ°æ•°æ®åŒ…ååˆ¤æ–­æŠ¥æ–‡èµ°å‘ï¼Œå¦‚æœæ˜¯æœ¬åœ°æŠ¥æ–‡æŠŠæ•°æ®ä¼ é€åˆ°ç”¨æˆ·æ€ï¼Œå¦‚æœæ˜¯è½¬å‘æŠ¥æ–‡æ ¹æ®é€‰è·¯ ï¼ˆäºŒå±‚äº¤æ¢æˆ–ä¸‰å±‚è·¯ç”±ï¼‰æŠŠæŠ¥æ–‡é€åˆ°å¦ä¸€ä¸ªç½‘å¡å¦‚ eth1ã€‚
å½“æœ‰ OVS æ—¶ï¼Œé¦–å…ˆæ˜¯åˆ›å»ºä¸€ä¸ªç½‘æ¡¥: ovs-vsctl add-br br0; ç„¶åç»‘å®šæŸä¸ªç½‘å¡: ovs-vsctl add-port br0 eth0; è¿™é‡Œé»˜è®¤ä¸ºç»‘å®šäº† eth0 ç½‘å¡ã€‚æ•°æ®æµå‘å¦‚çº¢è‰²æ‰€ ç¤º:</p>
<ol>
<li>ä»ç½‘å¡ eth0 æ”¶åˆ°æŠ¥æ–‡åç„¶ååˆ° OVS çš„ç«¯å£ Vport ä¸Šè¿›å…¥ OVS ä¸­ã€‚</li>
<li>flow table åœ¨å†…æ ¸ä¸­æœ‰ä¸€ä»½ï¼Œå½“ä»ç‰©ç†ç½‘å¡æ”¶åˆ°åŒ…åæ ¹æ® key å€¼è¿›è¡Œæµè¡¨åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸæ‰§è¡Œå¯¹åº”çš„ actionã€‚</li>
<li>å¦‚æœåŒ¹é…å¤±è´¥ï¼Œé€šè¿‡ upcall è°ƒç”¨ï¼Œå°†æ•°æ®åŒ…ä»¥ Netlink åè®®ä¸Šä¼ åˆ°ç”¨æˆ·æ€ï¼Œé€šè¿‡ ovs-vswitchd æŸ¥è¯¢ ovsdb è¿›è¡ŒæŸ¥è¡¨åŒ¹é…ã€‚</li>
<li>å¦‚æœè¿˜æ˜¯ä¸èƒ½åŒ¹é…ï¼Œåˆ™é€šè¿‡ OpenFlow åè®®åŸŸæ§åˆ¶å™¨é€šä¿¡ï¼Œæ§åˆ¶å™¨ä¸‹å‘æµè¡¨é¡¹ï¼Œovs-vswitchd è§£ææµè¡¨é¡¹å¾—åˆ°ç›¸åº”çš„åŠ¨ä½œï¼ŒåŒæ—¶å°†æµè¡¨å­˜åˆ° ovsdb ä¸­ã€‚</li>
<li>è‹¥èƒ½åŒ¹é…ä¸Šï¼Œå°†åŒ¹é…çš„æµè¡¨é¡¹é€šè¿‡ Netlink ä¸‹å‘åˆ°å†…æ ¸ä¸­çš„ flow table ä¸­ã€‚</li>
<li>é€šè¿‡ reinjectï¼Œä½¿ç”¨ Netlink å°†æ•°æ®åŒ…é‡æ–°é€å›å†…æ ¸</li>
<li>å†…æ ¸åŒ¹é…æµè¡¨é¡¹å¹¶æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚</li>
</ol>
<img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/635909-20160907114619848-1715526737.png" alt="OVSç½‘ç»œæ¶æ„1" style="zoom: 67%;" />
<p>åœ¨å·¥ä½œä¸­ä¸€èˆ¬åœ¨è¿™å‡ ä¸ªåœ°æ–¹æ¥ä¿®æ”¹å†…æ ¸ä»£ç ä»¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„:
ç¬¬ä¸€ä¸ªæ˜¯åœ¨ datapath.c ä¸­çš„ ovs_dp_process_received_packet(struct vport *p, struct sk_buff *skb) å‡½æ•°å†…æ·»åŠ ç›¸åº”çš„ä»£ç æ¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„ï¼Œè¿™é‡Œæ˜¯æ¯ä¸ªæ•°æ®åŒ…çš„å¿…ç»ä¹‹åœ°;
ç¬¬äºŒä¸ªå°±æ˜¯è‡ªå®šä¹‰çš„æµè¡¨ï¼Œå¯ä»¥æ ¹æ®æµè¡¨æ¥è®¾è®¡è‡ªå·±çš„ actionï¼Œå®Œæˆè‡ªå·±æƒ³è¦çš„åŠŸèƒ½ã€‚</p>
<h4 id="è¡¥å……ç½‘ç»œæ¦‚å¿µ">è¡¥å……ç½‘ç»œæ¦‚å¿µ</h4>
<ol>
<li>
<p>Bridge: è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œæ˜¯ä¸€ä¸ªä»¥å¤ªç½‘äº¤æ¢æœºï¼ˆSwitchï¼‰ï¼Œä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ª Bridge è®¾å¤‡ã€‚åœ¨ Openvswitch ä¸­æ¯ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼ˆvswitchï¼‰éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç½‘æ¡¥ï¼Œå› ä¸º Openvswitch åœ¨åº•å±‚çš„é€šä¿¡æ˜¯å€ŸåŠ©äº†ç½‘æ¡¥æ¨¡å—æ¥å®ç°çš„ã€‚</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230907170259377.png" alt="image-20230907170259377"></p>
</li>
<li>
<p>datapath: åœ¨ OVS ä¸­ï¼Œdatapath è´Ÿè´£æ‰§è¡Œæ•°æ®äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠä»æ¥æ”¶ç«¯å£æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨æµè¡¨ä¸­è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…åˆ°çš„åŠ¨ä½œã€‚datapath ä¹Ÿå¯ä»¥è¯´æ˜¯äº¤æ¢æœºã€ç½‘æ¡¥ã€‚å¦‚ä¸‹å›¾ï¼Œæ¯ä¸ª datapath é¡¹ä¸­æˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°å­˜åœ¨å‡ ä¸ª Port é¡¹ï¼Œå®ƒä»¬å…¶å®å°±æ˜¯è™šæ‹Ÿäº¤æ¢æœºï¼ˆdatapath) ä¸Šçš„ç«¯å£ã€‚datapath ç±»å‹åˆ†ä¸º netdev å’Œ system.
ä½¿ç”¨ ovs-vsctl show å¯ä»¥çœ‹åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œbr-int ä¸‹çš„ç«¯å£ tunnel_10_3_9_133_10_3_9_128 å°±ä¸è¿œç«¯çš„ç«¯å£å»ºç«‹äº† vxlan éš§é“ã€‚
<img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230908110903676.png" alt="image-20230908110903676"></p>
</li>
<li>
<p>Port: ç«¯å£ä¸ç‰©ç†äº¤æ¢æœºçš„ç«¯å£æ¦‚å¿µç±»ä¼¼ï¼Œæ¯ä¸ª Port éƒ½éš¶å±äºä¸€ä¸ª Bridgeï¼ˆdatapath)ã€‚</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230908101921215.png" alt="bridgeä¸‹çš„port"></p>
</li>
<li>
<p>Interface: è¿æ¥åˆ° Port çš„ç½‘ç»œæ¥å£è®¾å¤‡ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼ŒPort å’Œ Interface æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³», åªæœ‰åœ¨é…ç½® Port ä¸º bond æ¨¡å¼åï¼ŒPort å’Œ Interface æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p>
</li>
<li>
<p>Controller: OpenFlow æ§åˆ¶å™¨ã€‚OVS å¯ä»¥åŒæ—¶æ¥å—ä¸€ä¸ªæˆ–è€…å¤šä¸ª OpenFlow æ§åˆ¶å™¨çš„ç®¡ç†ã€‚</p>
</li>
<li>
<p>Flow table: æ¯ä¸ª datapath éƒ½å’Œä¸€ä¸ªâ€œflow tableâ€å…³è”ï¼Œå½“ datapath æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œ OVS ä¼šåœ¨ flow table ä¸­æŸ¥æ‰¾å¯ä»¥åŒ¹é…çš„ flowï¼Œæ‰§è¡Œå¯¹åº”çš„æ“ä½œ, ä¾‹å¦‚è½¬å‘æ•°æ®åˆ°å¦å¤–çš„ç«¯å£ã€‚æ”¯æŒ OpenFlow åè®®çš„äº¤æ¢æœºåº”è¯¥åŒ…æ‹¬ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµè¡¨ï¼Œæµè¡¨ä¸­çš„æ¡ç›®åŒ…å«ï¼šæ•°æ®åŒ…å¤´çš„ä¿¡æ¯ã€åŒ¹é…æˆåŠŸåè¦æ‰§è¡Œçš„æŒ‡ä»¤å’Œç»Ÿè®¡ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>Flow : åœ¨ OpenFlow çš„ç™½çš®ä¹¦ä¸­ï¼ŒFlow è¢«å®šä¹‰ä¸ºæŸä¸ªç‰¹å®šçš„ç½‘ç»œæµé‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª TCP è¿æ¥å°±æ˜¯ä¸€ä¸ª Flowï¼Œæˆ–è€…ä»æŸä¸ª IP åœ°å€å‘å‡ºæ¥çš„æ•°æ®åŒ…ï¼Œéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª Flowã€‚</p>
</li>
<li>
<p><strong><a href="http://arthurchiao.art/blog/ovs-deep-dive-4-patch-port/">patch</a></strong>: OVS é‡Œçš„ä¸åŒ bridge ä¹‹é—´å¯ä»¥é€šè¿‡ patch port è¿›è¡Œè¿æ¥ï¼Œç±»ä¼¼äº linux çš„ veth æ¥å£ã€‚patch ç«¯å£åªå­˜åœ¨ç½‘æ¡¥ä¸Šï¼Œdatapath ä¸­ä¸ä¼šå­˜åœ¨ï¼›å¦‚æœå‡ºç«¯å£ä¸º patch ç«¯å£ï¼Œåˆ™ç›¸å½“äºå…¶ peer è®¾å¤‡æ”¶åˆ°æŠ¥æ–‡ï¼Œåœ¨ peer è®¾å¤‡æ‰€åœ¨ç½‘æ¡¥æŸ¥æ‰¾ openflow æµè¡¨è¿›è¡Œè½¬å‘ï¼›ä¸åŒç±»å‹ datapath çš„ç½‘æ¡¥ä¸èƒ½é€šè¿‡ patch ç«¯å£ç›¸è¿æ¥ã€‚</p>
</li>
<li>
<p>Tun/Tap: TUN/TAP è®¾å¤‡æ˜¯ Linux å†…æ ¸ä¸­å®ç°çš„è™šæ‹Ÿç½‘å¡ã€‚ç‰©ç†ç½‘å¡æ˜¯ä»ç‰©ç†çº¿è·¯ä¸Šæ”¶å‘æ•°æ®åŒ…ï¼Œè€Œ TUN/TAP è®¾å¤‡æ˜¯ä»ç”¨æˆ·æ€åº”ç”¨ç¨‹åºä¸Šæ”¶å‘ä»¥å¤ªç½‘å¸§æˆ– IP åŒ…ã€‚TAP ç­‰åŒäºä»¥å¤ªç½‘è®¾å¤‡ï¼Œæ“ä½œ L2 æ•°æ®é“¾è·¯å±‚çš„æ•°æ®å¸§; TUN åˆ™æ˜¯æ¨¡æ‹Ÿ L3 ç½‘ç»œå±‚çš„è®¾å¤‡ï¼Œæ“ä½œç½‘ç»œå±‚çš„ IP æ•°æ®åŒ…ã€‚</p>
</li>
</ol>
<h3 id="vlog">VLOG</h3>
<p>OVS çš„ä¸¤ä¸ªè¿›ç¨‹ ovsdb-server å’Œ ovs-vswitchd éƒ½ä½¿ç”¨äº†å†…ç½®çš„ Vlog æ¥æ§åˆ¶å„è‡ªçš„ log å†…å®¹ï¼Œåˆç†çš„è®¾ç½® log æ¨¡å—å’Œ log ç­‰çº§æ–¹ä¾¿å®šä½é—®é¢˜æˆ–è€…å­¦ä¹ ã€‚</p>
<p>æˆ‘æ²¡æœ‰åƒå¤§å®¶ä¸€æ ·åœ¨å’±ä»¬å…¬å¸æ‰æ ¹æ—¶é—´é‚£ä¹ˆé•¿ï¼Œç°åœ¨ä¹ŸåªçŸ¥é“å…¬å¸æ˜¯æé€šä¿¡æ–¹é¢çš„ï¼Œæˆ‘æœ‰ç–‘é—®ä¹Ÿå¸Œæœ›ç†è§£ï¼Œ</p>
<p>Open vSwitch å…·æœ‰ä¸€ä¸ªå†…å»ºçš„æ—¥å¿—æœºåˆ¶ VLOGã€‚VLOG å·¥å…·å…è®¸ä½ åœ¨å„ç§ç½‘ç»œäº¤æ¢ç»„ä»¶ä¸­å¯ç”¨å¹¶è‡ªå®šä¹‰æ—¥å¿—ï¼Œç”± VLOG ç”Ÿæˆçš„æ—¥å¿—ä¿¡æ¯å¯ä»¥è¢«å‘é€åˆ°ä¸€ä¸ªæ§åˆ¶å°ã€syslog ä»¥åŠä¸€ä¸ªä¾¿äºæŸ¥çœ‹çš„å•ç‹¬æ—¥å¿—æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ ovs-appctl çš„å‘½ä»¤è¡Œå·¥å…·åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½® OVS æ—¥å¿—ã€‚</p>
<p>è®¾å¤‡ä¸Šçš„ OVS æ—¥å¿—å­˜æ”¾åœ¨ /datadisk0/var/log/openvswitch è·¯å¾„ä¸‹ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ ovs-appctl æŸ¥çœ‹æˆ–è€…ä¿®æ”¹ç›®æ ‡è¿›ç¨‹çš„ logï¼Œé»˜è®¤çš„ç›®æ ‡æ˜¯ ovs-vswitchdï¼Œå¯ä»¥é€šè¿‡å‚æ•° -t æŒ‡å®šå…·ä½“ç›®æ ‡ï¼Œ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ovs-appctl vlog/list <span class="c1"># ç­‰ä»·äº ovs-appctl -t ovs-vswitchd vlog/list</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ ovs-appctl -t ovsdb-server vlog/list
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ ovs-appctl vlog/list
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">                 console    syslog    file
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">                 -------    ------    ------
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">backtrace          OFF        ERR        ERR
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">bfd                OFF        ERR        ERR
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">bond               OFF        ERR        ERR
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">bridge             OFF        ERR        ERR
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">bundle             OFF        ERR        ERR
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">bundles            OFF        ERR        ERR
</span></span><span class="line"><span class="ln">10</span><span class="cl">cfm                OFF        ERR        ERR
</span></span><span class="line"><span class="ln">11</span><span class="cl">collectors         OFF        ERR        ERR
</span></span><span class="line"><span class="ln">12</span><span class="cl">command_line       OFF        ERR        ERR
</span></span><span class="line"><span class="ln">13</span><span class="cl">connmgr            OFF        ERR        ERR
</span></span><span class="line"><span class="ln">14</span><span class="cl">conntrack          OFF        ERR        ERR
</span></span><span class="line"><span class="ln">15</span><span class="cl">conntrack_tp       OFF        ERR        ERR
</span></span><span class="line"><span class="ln">16</span><span class="cl">coverage           OFF        ERR        ERR
</span></span><span class="line"><span class="ln">17</span><span class="cl">ct_dpif            OFF        ERR        ERR
</span></span><span class="line"><span class="ln">18</span><span class="cl">daemon             OFF        ERR        ERR
</span></span><span class="line"><span class="ln">19</span><span class="cl">daemon_unix        OFF        ERR        ERR
</span></span><span class="line"><span class="ln">20</span><span class="cl">dpdk               OFF        ERR        ERR
</span></span><span class="line"><span class="ln">21</span><span class="cl">...
</span></span></code></pre></div><p>è¾“å‡ºç»“æœæ˜¾ç¤ºäº†ç”¨äºä¸‰ä¸ªåœºåˆï¼ˆfacilityï¼šconsoleï¼Œsyslogï¼Œfileï¼‰çš„å„ä¸ªæ¨¡å—çš„è°ƒè¯•çº§åˆ«ã€‚è‡ªå®šä¹‰ VLOG çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ovs-appctl vlog/setmodule<span class="o">[</span>:facility<span class="o">[</span>:level<span class="o">]]</span>
</span></span></code></pre></div><p>å…¶ä¸­çš„ module å³æ¨¡å—åç§°ï¼ˆå¦‚ backtraceã€bfdã€dpdk ç­‰ï¼‰ï¼Œfacility å³æ—¥å¿—ä¿¡æ¯çš„ç›®çš„åœ°ï¼ˆå¿…é¡»æ˜¯ï¼šconsoleã€syslogã€æˆ–è€… fileï¼‰ï¼Œlevel å³æ—¥å¿—çš„è¯¦ç»†ç¨‹åº¦ï¼ˆå¿…é¡»æ˜¯ emerã€errã€warnã€infoã€æˆ–è€… dbg ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo ovs-appctl vlog/set dpdk:console:dbg <span class="c1"># ä¿®æ”¹ dpdk æ¨¡å—çš„ console çš„æ—¥å¿—çº§åˆ«ä¸º DBG</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ sudo ovs-appctl vlog/set ANY:console:dbg  <span class="c1"># ä¿®æ”¹æ¯ä¸ªæ¨¡å—çš„consoleçš„æ—¥å¿—çº§åˆ«ä¸ºDBG</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ sudo ovs-appctl vlog/set ANY:any:dbg 		<span class="c1"># ä¿®æ”¹æ¯ä¸ªæ¨¡å—çš„æ¯ä¸ªåœºåˆçš„æ—¥å¿—çº§åˆ«ä¸ºDBG</span>
</span></span></code></pre></div><p>dpdk æ¨¡å—çš„ console å·¥å…·å·²ç»å°†å…¶æ—¥å¿—ç­‰çº§ä¿®æ”¹ä¸º DBGï¼Œè€Œå…¶å®ƒä¸¤ä¸ªåœºåˆ syslog å’Œ file çš„æ—¥å¿—çº§åˆ«ä»ç„¶æ²¡æœ‰æ”¹å˜ã€‚</p>
<p><img src="https://images-1311785948.cos.ap-chengdu.myqcloud.com/typora/image-20230906160939722.png" alt="image-20230906160939722"></p>
</div>
  </div>
</article>


  
    <div class="pagination__title">
    <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬Discussion</span>
    <hr />
</div>
<script src="//cdn.jsdelivr.net/npm/twikoo@1.6.21/dist/twikoo.all.min.js"></script>
<div id="tcomment"></div><script>
    twikoo.init({
        envId: "https:\/\/twikoo.coldcoding.top\/",  
        el: "#tcomment", 
        
        
    });
</script>




    </div>
    <footer class="footer">
  <hr />
  <span>
    Copyright 2022-2024<a href="https://icp.gov.moe/?keyword=20241230" target="_blank">èŒICPå¤‡20241230å·</a>&nbsp;Powered by <a>æ„›</a> 
  </span>
  <span>
    All articles on this site are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a >
  </span>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <span class="topInner">
      <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
          <path d="M12 6H0l6-6z"/>
      </svg>
      <span id="read_progress"></span>
  </span>
</a>

<script>
  var backButton = document.getElementById("top-link");
  var lastScrollPosition = window.pageYOffset;

  function showBackButton() {
      backButton.style.visibility = "visible";
      backButton.style.opacity = '1';
  }
  function halfHideBackButton() {
      backButton.style.visibility = "visible";
      backButton.style.opacity = '0.3';
  }
  function hideBackButton() {
      backButton.style.visibility = "hidden";
      backButton.style.opacity = '0';
  }

  window.onscroll = function () {
      var currentScrollPosition = window.pageYOffset;
      if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
        showBackButton()
        if (Math.abs(currentScrollPosition - lastScrollPosition) < 10) {
          halfHideBackButton()
        }
      } else {
        hideBackButton()
      }
      lastScrollPosition = currentScrollPosition;
  };
</script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
      const container = codeblock.parentNode.parentNode;
      const copybutton = document.createElement('button');
      copybutton.classList.add('copy-code');
      copybutton.innerText = 'copy';
      console.log(copybutton)

      function copyingDone() {
          copybutton.innerText = 'copied!';
          setTimeout(() => {
              copybutton.innerText = 'copy';
          }, 2000);
      }

      copybutton.addEventListener('click', (cb) => {
          if ('clipboard' in navigator) {
              let text = codeblock.textContent;
              navigator.clipboard.writeText(text);
              copyingDone();
              return;
          }

          const range = document.createRange();
          range.selectNodeContents(codeblock);
          const selection = window.getSelection();
          selection.removeAllRanges();
          selection.addRange(range);
          try {
              document.execCommand('copy');
              copyingDone();
          } catch (e) {}
          selection.removeRange(range);
      });

      let language = codeblock.className.replaceAll("language-", "")
      let macTool = document.createElement("div")
      let macTool1 = document.createElement("div")
      let macTool2 = document.createElement("div")
      let macTool3 = document.createElement("div")
      let languageType = document.createElement("div")
      languageType.innerText = language
      macTool.setAttribute('class', 'mac-tool')
      macTool1.setAttribute('class', 'mac bb1')
      macTool2.setAttribute('class', 'mac bb2')
      macTool3.setAttribute('class', 'mac bb3')
      languageType.setAttribute('class', 'language-type')
      macTool.appendChild(macTool1)
      macTool.appendChild(macTool2)
      macTool.appendChild(macTool3)
      macTool.appendChild(languageType)

      if (container.classList.contains("highlight")) {
          container.appendChild(copybutton);
          container.appendChild(macTool)
      } else if (container.parentNode.firstChild == container) {
          
      } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
          
          codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
          container.appendChild(macTool)
      } else {
          
          codeblock.parentNode.appendChild(copybutton);
          container.appendChild(macTool)
      }
  });
</script></body>
</html>
